"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function dynamicWidth(){window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=document.querySelector("svg#field"),n=e.clientWidth,i=n<t?n:t;e.setAttribute("height",i),e.style.width=i+"px",e.setAttribute("width",i),buildField(e,i/2.5,.5*i-10,.9*i)}function buildField(t,e,n,i){var r=.1875*e*.5,c=.675*e,o=.15*e,a=e/Math.sqrt(2),l=.0375*e,s=.05*e,u=l*Math.sqrt(2),d=(Math.sqrt(o*o-l*l)-l)/Math.sqrt(2),h=(Math.sqrt(o*o-l*l)+l)/Math.sqrt(2);t.innerHTML='\n\t\t<path id="allField"\n\t\t\t  d="M'+n+", "+(i+2*d)+"\n\t\t\t\t L"+(n-3*e)+", "+(i+2*d-3*e)+"\n\t\t\t\t L"+(n+3*e)+", "+(i+2*d-3*e)+' Z" fill="'+grass+'" />\n\t\t<path id="redDiamond"\n\t\t\t  d="'+describeArc(n,i-c,e,-76,76)+"\n\t\t\t\t L"+(n-h)+", "+(i+u-h)+"\n\t\t\t\t "+describeArc(n,i,o,60,300,!0)+' Z" fill="'+redMud+'" />\n\t\t<line id="left-line" x1="'+n+'" y1="'+i+'" x2="'+(n-3*e)+'" y2="'+(i-3*e)+'"/>\n\t\t<line id="right-line" x1="'+n+'" y1="'+i+'" x2="'+(n+3*e)+'" y2="'+(i-3*e)+'"/>\n\t\t<path id="infield"\n\t\t\t  d="M'+(n-d)+", "+(i-u-d)+" \n\t\t\t\t L"+(n-a+u+d)+", "+(i-a+d)+" \n\t\t\t\t "+describeArc(n-a,i-a,o,60,120,!0)+" \n\t\t\t\t L"+(n-d)+", "+(i-2*a+u+d)+" \n\t\t\t\t "+describeArc(n,i-2*a,o,150,-150,!0)+"  \n\t\t\t\t L"+(n+a-u-d)+", "+(i-a-d)+" \n\t\t\t\t "+describeArc(n+a,i-a,o,-120,-60,!0)+" \n\t\t\t\t L"+(n+d)+", "+(i-u-d)+" \n\t\t\t\t "+describeArc(n,i,o,-30,30,!0)+' Z" fill="'+grass+'" />\n\t\t<circle id="pitcher" r="'+r+'" cx="'+n+'" cy="'+(i-c)+'" fill="'+redMud+'" />\n\t\t<g id="base">\n\t\t\t<line x1="'+(n-a)+'" y1="'+(i-a)+'" x2="'+n+'" y2="'+(i-2*a)+'" />\n\t\t\t<line x1="'+n+'" y1="'+(i-2*a)+'" x2="'+(n+a)+'" y2="'+(i-a)+'" />\n\t\t\t<rect id="secondBase" class="base" x="'+n+'" y="'+(i-2*a-.5*s)+'" width="'+s+'" height="'+s+'" />\n\t\t\t<rect id="thirdBase" class="base" x="'+(n-a)+'" y="'+(i-a)+'" width="'+s+'" height="'+s+'" />\n\t\t\t<rect id="firstBase" class="base" x="'+(n+a)+'" y="'+(i-a)+'" width="'+s+'" height="'+s+'" />\n\t\t\t<path id="homeBase" class="base" \n\t\t\t\t  d="M'+n+", "+i+"\n\t\t\t\t\t l-"+.5*s+", -"+.5*s+"\n\t\t\t\t\t l0, -"+.5*s+"\n\t\t\t\t\t l"+s+", 0\n\t\t\t\t\t l0, "+.5*s+' Z" />\n\t\t</g>\n\t\t<g id="fielder">\n\t\t\t<foreignObject id="f-7" width="24" height="24" x="'+(n-e)+'" y="'+(i-2.5*a)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-8" width="24" height="24" x="'+(n-9)+'" y="'+(i-3*a)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-9" width="24" height="24" x="'+(n+e-9)+'" y="'+(i-2.5*a)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-6" width="24" height="24" x="'+(n-a)+'" y="'+(i-a-.35*e)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-5" width="24" height="24" x="'+(n-.35*e)+'" y="'+(i-2*a-.5*s)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-4" width="24" height="24" x="'+(n+.25*e)+'" y="'+(i-2*a-.5*s)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-3" width="24" height="24" x="'+(n+a-.1*e)+'" y="'+(i-a-.35*e)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-2" width="24" height="24" x="'+(n-9)+'" y="'+i+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t\t<foreignObject id="f-1" width="24" height="24" x="'+(n-9)+'" y="'+(i-c-.5*r)+'"><i class="glyphicon glyphicon-sunglasses"></i></foreignObject>\n\t\t</g>\n\t\t<g id="runner">\n\t\t\t<foreignObject id="currentRunner" width="24" height="24" x="'+(n-9)+'" y="'+(i-15)+'"><i class="glyphicon glyphicon-user"></i></foreignObject>\n\t\t</g>',document.querySelector("#currentRunner").addEventListener("click",function(t){var e=[{x:n-9,y:i-15,dir:[1,-1]},{x:n-9+a,y:i-15-a,dir:[-1,-1]},{x:n-9,y:i-15-2*a,dir:[-1,1]},{x:n-9-a,y:i-15-a,dir:[1,1]}],r=function(){return{x:parseInt(t.target.parentElement.getAttribute("x")),y:parseInt(t.target.parentElement.getAttribute("y"))}};e.map(function(n,i){var c=r();if(c.x==parseInt(n.x)&&c.y==parseInt(n.y))var o=e[(i+1)%e.length],a=o.x,l=o.y,s=setInterval(function(){var e=r(),i=e.x,c=e.y;t.target.parentElement.setAttribute("x",i+n.dir[0]),t.target.parentElement.setAttribute("y",c+n.dir[1]),(n.dir[0]*(i-a)>0||n.dir[1]*(c-l)>0)&&(t.target.parentElement.setAttribute("x",a),t.target.parentElement.setAttribute("y",l),clearInterval(s))},5)})},!1)}function polarToCartesian(t,e,n,i){var r=(i-90)*Math.PI/180;return{x:t+n*Math.cos(r),y:e+n*Math.sin(r)}}function describeArc(t,e,n,i,r){var c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=polarToCartesian(t,e,n,r),l=polarToCartesian(t,e,n,i),s=r-i<=180?"0":"1";if(o)return[a.x,a.y].join(" ");var u=c?[]:["M",a.x,a.y];return u=[].concat(_toConsumableArray(u),["A",n,n,0,s,0,l.x,l.y]).join(" ")}function recordPitch(t){var e=t.currentTarget;if("BUTTON"===e.tagName){var n=e.querySelector(".symb");document.querySelector("#record").innerHTML+=n.outerHTML+" ",currentPitch.push(e.id),checkPitch()}}function deletePitch(){var t=document.querySelector("#record"),e=t.querySelector("i:last-of-type");e&&(t.removeChild(e),currentPitch.pop())}function checkPitch(){var t=!1;currentPitch.includes("o")?(t=alert("上壘!"),document.querySelector("#pitch").classList.add("none"),[].concat(_toConsumableArray(document.querySelectorAll('[id^="hit-"]'))).map(function(t){return t.classList.remove("none")}),document.querySelector("#hit-pos-container").innerHTML+=hitPosContent,document.querySelector(".hit-pos:last-of-type").addEventListener("click",hitPosTrigger,!1)):4===currentPitch.count("b")?t=confirm("保送，進入下一個打席?"):(currentPitch.count("s")+currentPitch.count("w")===3||currentPitch.count("s")+currentPitch.count("w")+currentPitch.count("f")>=3&&"f"!==currentPitch.last())&&(t=confirm("三振出局，進入下一個打席?")),t&&(addHistory(),document.querySelector("#record").innerHTML="")}function addHistory(){currentPitch=[];var t=document.querySelector("#record").innerHTML,e=document.querySelector("#history");e.innerHTML='<li class="list-group-item">'+t+"</li>"+e.innerHTML}function hitPosTrigger(t){if("LABEL"===t.target.tagName){var e=t.currentTarget.querySelector(".active");e&&e.classList.remove("active"),t.target.classList.add("active"),"cancel"==t.target.innerText?t.target.classList.remove("active"):(document.querySelector("#hit-pos-container").innerHTML+=hitPosContent,document.querySelector(".hit-pos:last-of-type").addEventListener("click",hitPosTrigger,!1))}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},redMud="#E41010",grass="#50A160",hitPosContent='<div class="btn-group hit-pos" data-toggle="buttons">\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-1" autocomplete="off">1</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-2" autocomplete="off">2</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-3" autocomplete="off">3</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-4" autocomplete="off">4</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-5" autocomplete="off">5</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-6" autocomplete="off">6</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-7" autocomplete="off">7</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-8" autocomplete="off">8</label>\n\t\t\t  <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="f-9" autocomplete="off">9</label>\n\t\t\t  \x3c!-- <label class="btn btn-default"><input type="radio" name="hit-pos-1" value="cancel" autocomplete="off">cancel</label> --\x3e\n\t\t\t</div>',currentPitch=[];dynamicWidth(),window.onresize=function(t){dynamicWidth()},[].concat(_toConsumableArray(document.querySelectorAll("#pitch > button"))).map(function(t){return t.addEventListener("click",recordPitch,!1)}),Object.defineProperties(Array.prototype,{count:{value:function(t){for(var e=0,n=0;n<this.length;n++)"object"==_typeof(this[n])?e+=this[n].count(t):this[n]==t&&++e;return e}},last:{value:function(){return this[this.length-1]}}});